<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109547610-1"></script>
		<script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-109547610-1');
		</script>

		<title>PWA 2k17</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/my.css">
		<link rel="stylesheet" href="css/my.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			let link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h4>PWA в 2017: плюсы, минусы и грабли<span class="fragment">,<br> а также набор хаков, чтобы все работало на iOS</span></h4>
					<p>Плесских Иван</p>
				</section>
				<section>
					<h5>Калибровка на аудиторию</h5>
					<p class="fragment">Знаете что такое PWA?</p>
					<p class="fragment">Используете?</p>
					<p class="fragment">Почему нет?</p>
				</section>
				<section>
					<h5>Быстрое введение в тему</h5>
					<p class="fragment">Что говорит гугл про PWA?</p>
					<img class="fragment" src="img/pva.png" />
					<p class="fragment">Тема раскрыта слабовато (особенно в рунете)</p>
				</section>
				<section>
					<h5>Быстрое введение в тему</h5>
					<q>Progressive Web App (PWA) is a term used to denote web applications that use the latest web technologies.</q>
					<p class="fragment">Серьёзно?</p>
					<q class="fragment">Progressive Web Apps, also known as Installable Web Apps or Hybrid Web Apps, are regular web pages or websites, but can appear to the user like traditional applications or native mobile applications. The application type attempts to combine features offered by most modern browsers with the benefits of mobile experience.</q>
				</section>
				<section>
					<h5>Быстрое введение в тему своими словами</h5>
					<ol>
						<li class="fragment">Обычный сайт (или SPA), https</li>
						<li class="fragment">Работа offline</li>
						<li class="fragment">Пуши</li>
						<li class="fragment">Отдельная иконка на мобилках</li>
						<li class="fragment">???</li>
						<li class="fragment">PWA!</li>
					</ol>
				</section>
				<section>
					<h5>Зачем вообще нужно?</h5>
					<ol>
						<li>Работа offline</li>
						<li>Пуши</li>
						<li>Отдельная иконка на мобилках</li>
						<li class="fragment">Выше в поисковой выдаче (+ https)</li>
					</ol>
					<p class="fragment">Главные преимущества приложений,<br>но не паримся с самим приложением!</p>
				</section>
				<section>
					<h5>Калибровка на аудиторию</h5>
					<p class="fragment">Мобильное приложение есть/надо?</p>
					<p class="fragment">Разработчиков искали/ищете?</p>
					<p class="fragment">Долго искали/как успехи?</p>
				</section>
				<section>
					<h5>Прекрасный новый мир</h5>
					<p class="fragment">Никаких больше нативных приложений!</p>
					<p class="fragment">Никаких больше айоcников и андроидщиков!</p>
					<p class="fragment">(винфоны все равно никто не использует)</p>
					<p class="fragment">(но PWA на них работать будут, Microsoft обещает)</p>
					<p class="fragment">Bye Java, Kotlin, Swift, Obj-C, C# and more and more...</p>
					<h1 class="fragment">ALL HAIL JAVASCRIPT!</h1>
				</section>
				<section>
					<p class="fragment">Примерно так это расписывает гугл, <br>который и продвигает PWA</p>
					<p class="fragment">Но, как всем нам прекрасно известно, <br>у любой утопии есть изнанка...</p>
					<p class="fragment">А серебрянные пули — сказка для взрослых,<br>уставших от несовершенства этого мира</p>
				</section>
				<section>
					<h5>Трезвый взгляд</h5>
					<ol>
						<li class="fragment">Медленно <span class="fragment">(но...)</span></li>
						<li class="fragment">Неполноценно <span class="fragment">(но...)</span></li>
						<li class="fragment">Android-only <span class="fragment">(но...)</span></li>
					</ol>
				</section>
				<section>
					<h5>Скорость</h5>
					<p>Все же, это веб, со всеми вытекающими</p>
					<p class="fragment">Но прямыми руками его можно и разогнать</p>
					<p class="fragment">Что сложнее, чем сделать быстрое приложение,<br>но сложность компенсируется синергией</p>
					<p class="fragment">Ведь ускорение PWA ускоряет и сайт!</p>
					<p class="fragment">К теме синергии ещё вернемся</p>
				</section>
				<section>
					<h5>Ограниченность</h5>
					<p>Опять же, это веб.</p>
					<p class="fragment">Но, на самом деле, многим и этого хватит</p>
					<p class="fragment">Для content-first сайтов - вариант отличный</p>
					<p class="fragment">Пример, упирающийся в ограничения веба?</p>
					<p class="fragment">Нет, я не забыл его вписать, просто не знаю</p>
				</section>
				<section>
					<h5>Поддержка</h5>
					<p>Chrome for Android <span class="fragment">(и то с ограничениями)</span></p>
					<p class="fragment">Обязателен, собственно, Chrome <span class="fragment">(что не так критично)</span> </p>
					<p class="fragment">Установка нова для пользователя <span class="fragment">(но это поправимо)</span></p>
					<p class="fragment">iOS в пролёте <span class="fragment">(но можно кое-что накостылять)</span></p>
					<p class="fragment">А Windows 10 Mobile все равно никто не пользуется :)</p>
					<p class="fragment">(но Microsoft обещает что PWA у них будет, ждём)</p>
				</section>
				<section>
					<h5>Наше приложение</h5>
					<ol>
						<li>Мессенджер</li>
						<li>SPA, React+Redux</li>
						<li>Мобила очень нужна</li>
						<li>iOS в приоритете</li>
					</ol>
				</section>
				<section>
					<h5>Завязка</h5>
					<p>Есть сайт, очень нужна мобильная версия,<br> причем в основном под iOS</p>
					<p class="fragment">Айосников в Челябинске...</p>
					<p class="fragment">Неосторожно пророненное мной "PWA" рождает искру</p>
					<p class="fragment">В итоге ПМ постановляет: будем пробовать</p>
				</section>
				<section>
					<h5>И сразу развязка</h5>
					<p class="fragment">Есть приложения для Android и iOS</p>
					<p class="fragment">Под андроид (пока) ставится через хром</p>
					<p class="fragment">Костылей под iOS в js не так уж и много</p>
					<p class="fragment">App Store одобрил</p>
					<p class="fragment">На айоснике сэкономили :)</p>
				</section>
				<section>
					<h5>Промежуточные выводы</h5>
					<p class="fragment">В идеале все делается очень просто</p>
					<p class="fragment">В реальности тоже не слишком сложно</p>
					<p class="fragment">Синергия действительно работает</p>
					<p class="fragment">Обновления доставляются моментально</p>
					<p class="fragment">Упрощает проверку гипотез</p>
					<p class="fragment">Сафари - это новый Internet Explorer</p>
				</section>
				<section>
					<h5>Калибровка на аудиторию</h5>
					<p class="fragment">Сафари кто-нибудь любит?</p>
					<p class="fragment">А мобильный?</p>
					<p class="fragment">А как разработчик? :)</p>
				</section>
				<section>
					<h5>Лирическое отступление — косяки Сафари</h5>
					<p class="fragment">Ориентация фотографий в EXIF</p>
					<p class="fragment">Решение — крутить фотки на сервере</p>
					<p class="fragment">Не позволяет отправить созданный вручную файл</p>
					<p class="fragment">Решение — не отправлять созданные вручную файлы</p>
					<p class="fragment">Аттрибут download на теге a игнорируется</p>
					<p class="fragment">Решение — явно открывать файл в новой вкладке</p>
				</section>
				<section>
					<h5>Косяки Сафари: часть 2</h5>
					<p class="fragment">Не снимает фокус с поля ввода при клике в никуда</p>
					<p class="fragment">Решение — установить tabindex на body</p>
					<p class="fragment">Но тогда при клике в никуда все моргает серым</p>
					<p class="fragment">Решение — -webkit-tap-highlight-color: transparent</p>
					<p class="fragment">Почему не использовать кнопку "Done"?</p>
					<p class="fragment">Об этом — далее</p>
				</section>
				<section>
					<h5>Косяки Сафари: часть 3</h5>
					<p class="fragment">fetch косячит в 11.0 (в 11.1 нормально)</p>
					<pre class="fragment"><code data-trim>
						fetch('http://example.com/fkin-big.file')
						.then(function(resp) {
							resp.clone()
							resp.clone() //здесь может быть event.respondWith
						}).catch(function(err) {
							console.log(err.message)
						})
					</code></pre>
					<p class="fragment">"Cannot clone a disturbed Response"</p>
					<p class="fragment">Решение — использовать полифилл</p>
				</section>
				<section>
					<h5>Шаги для Android</h5>
					<ol>
						<li class="fragment">Идём в гугл</li>
						<li class="fragment">Добавляем манифест</li>
						<li class="fragment">Добавляем service worker</li>
						<li class="fragment">Немного колдуем с FCM</li>
						<li class="fragment">Охапка дров</li>
						<li class="fragment">PWA готов!</li>
					</ol>
				</section>
				<section>
					<h5>Результат на Android</h5>
					<p class="fragment">Места не занимает вообще <span class="fragment">(ну... Только кеш :)</span></p>
					<p class="fragment">Но требует Хром, что плохо</p>
					<p class="fragment">Ставится легко, но сложно</p>
					<p class="fragment">Под силу даже бухгалтеру</p>
					<p class="fragment">Нет тонкого управления пушами</p>
					<p class="fragment">Можно сделать обычное приложение</p>
				</section>
				<section>
					<h5>Шаги для iOS</h5>
					<ol>
						<li class="fragment">Идём в гугл</li>
						<li class="fragment"><img src="img/pwa-ios.png" /></li>
						<li class="fragment">Всё ещё любите Сафари?</li>
						<li class="fragment">Снова идем в гугл, много ищем</li>
						<li class="fragment">Покупаем Mac</li>
						<li class="fragment">Напряженно костыляем</li>
						<li class="fragment">Псевдо-PWA готов!</li>
					</ol>
				</section>
				<section>
					<h5>Результат на iOS</h5>
					<p class="fragment">Выглядит как обычное приложение</p>
					<p class="fragment">Использует PhoneGap с кучей <del>костылей</del> плагинов</p>
					<p class="fragment">Верстаем под обычный мобильный Сафари</p>
					<p class="fragment">Места занимает мало, WebView на марше</p>
					<p class="fragment">Обновления благодаря WebView видны сразу</p>
					<p class="fragment">Чтобы все заработало, пришлось постараться</p>
				</section>
				<section>
					<h5>App Store Story</h5>
					<p class="fragment">Одобрено</p>
					<p class="fragment">Мы думали, будет гораздо сложнее</p>
					<img class="fragment" src="img/appstore.jpg" />
				</section>
				<section>
					<h5>PhoneGap Tale I</h5>
					<p class="fragment">Необходимо дать сайту доступ к Cordova API</p>
					<p class="fragment">Решение — <code>cordova-plugin-remote-injection</code></p>
					<p class="fragment">Надо запретить левым сайтам доступ к Cordova API</p>
					<p class="fragment">Решение — <code>cordova-plugin-whitelist</code></p>
					<p class="fragment">В исключения добавляем домены стейджинга</p>
					<p class="fragment">Используем ngrok для разработки в условиях, <br>максимально приближенных к боевым</p>
				</section>
				<section>
					<h5>PhoneGap Tale II</h5>
					<p class="fragment">Нужны пуши</p>
					<p class="fragment">Решение — <code>cordova-plugin-fcm</code></p>
					<p class="fragment">Он же позволяет установить бейдж на иконке <img src="img/badge.png" /></p>
					<p class="fragment">APNS content-available — пришлось допиливать</p>
					<p class="fragment">Отписка от пушей — та же история (метод kill)</p>
					<p class="fragment"><a href="https://github.com/Amareis/cordova-plugin-fcm">https://github.com/Amareis/cordova-plugin-fcm</a></p>
				</section>
				<section>
					<h5>PhoneGap Tale III</h5>
					<p class="fragment">Плагин для FCM ломает компиляцию приложения</p>
					<p class="fragment">Решение — вручную скопировать нужный файл</p>
					<p class="fragment">Отписка от пушей не работает в оффлайне</p>
					<p class="fragment">Решение — не давать отписываться в оффлайне</p>
				</section>
				<section>
					<h5>PhoneGap Tale IV</h5>
					<p class="fragment">Первый запуск приложения должен быть онлайн</p>
					<p class="fragment">Решение — ErrorUrl + настройка remote-injection</p>
					<p class="fragment">Полоска над iOS клавиатурой</p>
					<p class="fragment">Решение — <code>cordova-plugin-keyboard</code> + HideKeyboardFormAccessoryBar</p>
				</section>
				<section>
					<h5>PhoneGap Tale V</h5>
					<p class="fragment"><code>phonegap-plugin-service-worker</code> не реджектит fetch при ошибках сети</p>
					<p class="fragment">Решение — использовать форк с fetch полифиллом</p>
					<p class="fragment">Кеш плагина сильно раздувается</p>
					<p class="fragment">Решение — использовать форки (?),<br> кастомная логика сброса кеша через postMessage</p>
				</section>
				<section>
					<h5>PhoneGap Tale VI</h5>
					<p class="fragment">Отладка?</p>
					<p class="fragment">XCode, console.log, Safari Remote Debug, weinre</p>
					<p class="fragment">Проблемы со сборкой<br>(не отображаются изменения в файлах)</p>
					<p class="fragment">Решение — <code>cd ../.. && phonegap prepare ios</code><br> в Build Phases</p>
				</section>
				<section>
					<h5>PhoneGap Tale X</h5>
					<p class="fragment">Просто набор плагинов, которые нужны для начала </p>
					<p class="fragment">cordova-plugin-badge<br>
						cordova-plugin-console<br>
						cordova-plugin-inappbrowser<br>
						cordova-plugin-media-capture<br>
						cordova-plugin-splashscreen<br>
						cordova-plugin-statusbar
					</p>
				</section>
				<section>
					<h5>Итоги</h5>
					<p class="fragment">PWA сейчас на хайпе, но ещё не взлетели</p>
					<p class="fragment">Применять можно уже сейчас,<br>хотя не хватает нормальных полифиллов</p>
					<p class="fragment">Как минимум, стоит ознакомиться,<br>чтобы потом не было мучительно больно</p>
				</section>
				<section>
					<div  class="fragment">
						<h5>Спасибо за внимание!</h5>
						<p style="font-size: 8px;">Ищем айосника, $300 за рекомендацию :)<br><a href="http://gudex-start.tilda.ws">gudex-start.tilda.ws</a></p>
					</div>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                width: 1100,
				controls: false,
                defaultTiming: 0,
                slideNumber: true,
				viewDistance: 1000,
                history: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
